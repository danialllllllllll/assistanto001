<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Training Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced AI Learning Progress</h1>
            <p class="subtitle">All just to create a personal AI assistant</p>
        </header>

        <div class="dashboard-grid">
            <div class="card stage-card">
                <h2>Current Stage</h2>
                <div id="current-stage" class="stage-name">Initializing...</div>
                <div class="progress-container">
                    <div id="stage-progress-bar" class="progress-bar">
                        <div id="stage-progress-fill" class="progress-fill"></div>
                    </div>
                    <div id="stage-progress-text" class="progress-text">0%</div>
                </div>
                <div id="iteration-count" class="iteration-text">Iteration: 0</div>
                <div class="time-estimate">
                    <span class="estimate-label">Estimated time until Next Phase:</span>
                    <span id="time-estimate" class="estimate-value">Calculating...</span>
                </div>
                <div class="time-estimate" style="margin-top: 8px;">
                    <span class="estimate-label">Time until completion:</span>
                    <span id="total-estimate" class="estimate-value">Calculating...</span>
                </div>
            </div>

            <div class="card metrics-card">
                <h2>Understanding Metrics</h2>
                <div class="metric-row">
                    <span class="metric-label">Understanding:</span>
                    <span id="understanding-score" class="metric-value">0.000%</span>
                    <span id="understanding-status" class="status-indicator">...</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Confidence:</span>
                    <span id="confidence-score" class="metric-value">0.000%</span>
                    <span id="confidence-status" class="status-indicator">...</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Accuracy:</span>
                    <span id="accuracy-score" class="metric-value">0.000%</span>
                </div>
                <div class="threshold-info">
                    <strong>Required:</strong> 99.9% understanding & 99.9% confidence to Advance
                </div>
            </div>

            <div class="card personality-card">
                <h2>Personality Traits</h2>
                <div id="personality-traits" class="traits-container">
                    <p class="empty-state">Personality develops in Teen stage...</p>
                </div>
            </div>

            <div class="card philosophy-card">
                <h2>Philosophy Insights</h2>
                <div id="philosophy-insights" class="insights-container">
                    <p class="empty-state">Philosophy reasoning begins in Thinker stage...</p>
                </div>
            </div>

            <div class="card values-card">
                <h2>Core Values Compliance</h2>
                <div id="core-values" class="values-container">
                    <div class="value-item">
                        <span class="value-name">Always be Kind</span>
                        <span class="value-status">‚úì Enforced</span>
                    </div>
                    <div class="value-item">
                        <span class="value-name">Value Understanding over Quantity</span>
                        <span class="value-status">‚úì Enforced</span>
                    </div>
                    <div class="value-item">
                        <span class="value-name">Always Speak the Truth</span>
                        <span class="value-status">‚úì Enforced</span>
                    </div>
                    <div class="value-item">
                        <span class="value-name">Facilitate Positive Relationships with User</span>
                        <span class="value-status">‚úì Enforced</span>
                    </div>
                    <div class="value-item">
                        <span class="value-name">Do No Harm</span>
                        <span class="value-status">‚úì Enforced</span>
                    </div>
                </div>
            </div>

            <div class="card history-card">
                <h2>Training History</h2>
                <div id="training-history" class="history-container">
                    <p class="empty-state">Training history will appear here...</p>
                </div>
            </div>

            <div class="card web-knowledge-card">
                <h2>üåê Web-Acquired Knowledge</h2>
                <div id="web-knowledge-stats" class="knowledge-stats">
                    <p class="stats-text">Total: <span id="total-knowledge">0</span> topics</p>
                </div>
                <div id="web-knowledge" class="knowledge-container">
                    <p class="empty-state">Web knowledge will appear here...</p>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <span id="training-status">‚è∏Ô∏è Waiting to start...</span>
            <span id="last-update">Last update: Never</span>
            <button id="refresh-btn" onclick="updateDashboard()" style="margin-left: 10px; padding: 5px 15px; cursor: pointer;">üîÑ Refresh</button>
        </div>
    </div>

    <script>
        let updateInterval = 2000;
        let updateTimer = null;
        
        function updateDashboard() {
            fetch('/api/status')
                .then(response => {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('current-stage').textContent = data.current_stage;
                    
                    const understanding = (data.understanding_score * 100).toFixed(3);
                    const confidence = (data.confidence * 100).toFixed(3);
                    const accuracy = (data.accuracy * 100).toFixed(3);
                    
                    document.getElementById('understanding-score').textContent = understanding + '%';
                    document.getElementById('confidence-score').textContent = confidence + '%';
                    document.getElementById('accuracy-score').textContent = accuracy + '%';
                    
                    const understandingStatus = data.understanding_score >= 0.999 ? '‚úì' : 
                                               data.understanding_score >= 0.9 ? '‚ö°' : '...';
                    document.getElementById('understanding-status').textContent = understandingStatus;
                    
                    const confidenceStatus = data.confidence >= 0.999 ? '‚úì' : 
                                            data.confidence >= 0.9 ? '‚ö°' : '...';
                    document.getElementById('confidence-status').textContent = confidenceStatus;
                    
                    const progressPercent = ((data.stage_index + 1) / data.total_stages) * 100;
                    document.getElementById('stage-progress-fill').style.width = progressPercent + '%';
                    document.getElementById('stage-progress-text').textContent = 
                        `Stage ${data.stage_index + 1}/${data.total_stages}`;
                    
                    document.getElementById('iteration-count').textContent = `Iteration: ${data.iteration}`;
                    
                    if (data.time_estimate) {
                        if (data.time_estimate.next_stage_eta) {
                            document.getElementById('time-estimate').textContent = data.time_estimate.next_stage_eta;
                        }
                        if (data.time_estimate.total_completion_eta) {
                            document.getElementById('total-estimate').textContent = data.time_estimate.total_completion_eta;
                        }
                    }
                    
                    const statusText = data.training_active ? 'Training Active' : '‚è∏Ô∏è Paused';
                    document.getElementById('training-status').textContent = statusText;
                    
                    updateInterval = data.training_active ? 1000 : 5000;
                    
                    document.getElementById('last-update').textContent = 
                        `Last update: ${new Date().toLocaleTimeString()}`;
                })
                .catch(error => {
                    console.error('Update failed:', error);
                    document.getElementById('training-status').textContent = 'Connection Error';
                    updateInterval = 5000;
                });

            fetch('/api/personality')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('personality-traits');
                    if (data.traits && Object.keys(data.traits).length > 0) {
                        let html = '';
                        for (const [trait, value] of Object.entries(data.traits)) {
                            const percent = (value * 100).toFixed(0);
                            html += `
                                <div class="trait-item">
                                    <span class="trait-name">${trait}:</span>
                                    <div class="trait-bar">
                                        <div class="trait-fill" style="width: ${percent}%"></div>
                                    </div>
                                    <span class="trait-value">${percent}%</span>
                                </div>
                            `;
                        }
                        container.innerHTML = html;
                    }
                });

            fetch('/api/philosophy')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('philosophy-insights');
                    if (data.insights && data.insights.length > 0) {
                        let html = '';
                        data.insights.slice(-5).reverse().forEach(insight => {
                            html += `
                                <div class="insight-item">
                                    <div class="insight-text">${insight.insight}</div>
                                    <div class="insight-time">${new Date(insight.timestamp).toLocaleTimeString()}</div>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                    }
                });

            fetch('/api/progress')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('training-history');
                    if (data.history && data.history.length > 0) {
                        let html = '';
                        data.history.slice(-5).reverse().forEach(item => {
                            const status = item.passed ? '‚úì' : '‚ö†';
                            const statusClass = item.passed ? 'passed' : 'needs-work';
                            html += `
                                <div class="history-item ${statusClass}">
                                    <span class="history-stage">${item.stage}</span>
                                    <span class="history-score">${(item.understanding * 100).toFixed(1)}%</span>
                                    <span class="history-status">${status}</span>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                    }
                });

            fetch('/api/web_knowledge')
                .then(response => response.json())
                .then(data => {
                    if (data.stats) {
                        document.getElementById('total-knowledge').textContent = data.stats.total_acquired || 0;
                    }
                    
                    const container = document.getElementById('web-knowledge');
                    if (data.recent_knowledge && data.recent_knowledge.length > 0) {
                        let html = '';
                        data.recent_knowledge.slice(-5).reverse().forEach(item => {
                            html += `
                                <div class="knowledge-item">
                                    <div class="knowledge-topic">üìñ ${item.topic}</div>
                                    <div class="knowledge-stage">${item.stage}</div>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                    }
                })
                .catch(error => {
                    console.error('Failed to fetch web knowledge:', error);
                });
        }

        function scheduleNextUpdate() {
            if (updateTimer) clearTimeout(updateTimer);
            updateTimer = setTimeout(() => {
                updateDashboard();
                scheduleNextUpdate();
            }, updateInterval);
        }
        
        updateDashboard();
        scheduleNextUpdate();
    </script>
</body>
</html>
